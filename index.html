<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
<meta name="theme-color" content="#000000" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<title>Calculadora</title>
<style>
:root{
  --bg:#000;
  --key-dark:#333;
  --key-fn:#a5a5a5;
  --key-op:#ff9f0a;
  --key-op-press:#ffb84d;
  --text:#fff;
  --bottom-lift:56px;
  --key-size:84px;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text",system-ui;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{
  margin:0;width:100%;height:100%;
  background:#000;color:var(--text);
  overflow:hidden;
}
body{position:fixed;inset:0;background:#000;touch-action:none}
.calculator{
  width:100vw;height:100svh;background:#000;
  display:flex;flex-direction:column;justify-content:flex-end;
  padding:0 max(14px,env(safe-area-inset-right))
          max(calc(env(safe-area-inset-bottom)-var(--bottom-lift)),8px)
          max(14px,env(safe-area-inset-left));
}
.display-wrap{position:relative;padding:0 6px 4px}
.display{height:132px;display:flex;align-items:flex-end;justify-content:flex-end}
.display span{
  font-size:72px;font-weight:300;letter-spacing:-.02em;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis
}
.badge{
  position:absolute;right:8px;top:6px;
  padding:6px 10px;font-size:12px;color:rgba(255,255,255,.9);
  background:rgba(255,255,255,.14);border-radius:999px;
  backdrop-filter:blur(10px);display:none
}
.badge.show{display:inline-flex;gap:6px}
.keys{
  display:grid;grid-template-columns:repeat(4,1fr);
  gap:16px;margin-bottom:var(--bottom-lift)
}
button{
  border:none;border-radius:50%;
  height:var(--key-size);min-width:var(--key-size);
  aspect-ratio:1/1;font-size:34px;cursor:pointer;
  display:flex;align-items:center;justify-content:center
}
button:active{filter:brightness(1.12)}
.key-num{background:var(--key-dark);color:#fff}
.key-fn{background:var(--key-fn);color:#000}
.key-op{background:var(--key-op);color:#fff}
.key-op:active{background:var(--key-op-press)}
@media(max-width:380px){
  :root{--key-size:76px;--bottom-lift:48px}
  .display{height:120px}.display span{font-size:62px}
  button{font-size:30px}.keys{gap:14px}
}
</style>
</head>
<body>
<div class="calculator">
  <div class="display-wrap">
    <div class="badge" id="badge"><strong>Versión</strong><span>v0.2</span></div>
    <div class="display"><span id="display">0</span></div>
  </div>
  <div class="keys">
    <button class="key-fn" data-action="backspace">⌫</button>
    <button class="key-fn" data-action="ac">AC</button>
    <button class="key-fn" data-action="percent">%</button>
    <button class="key-op" data-op="÷">÷</button>
    <button class="key-num" data-num="7">7</button>
    <button class="key-num" data-num="8">8</button>
    <button class="key-num" data-num="9">9</button>
    <button class="key-op" data-op="×">×</button>
    <button class="key-num" data-num="4">4</button>
    <button class="key-num" data-num="5">5</button>
    <button class="key-num" data-num="6">6</button>
    <button class="key-op" data-op="−">−</button>
    <button class="key-num" id="key-1" data-num="1">1</button>
    <button class="key-num" data-num="2">2</button>
    <button class="key-num" data-num="3">3</button>
    <button class="key-op" data-op="+">+</button>
    <button class="key-num" data-action="sign">±</button>
    <button class="key-num" data-num="0">0</button>
    <button class="key-num" data-action="dot">,</button>
    <button class="key-op" data-action="equals">=</button>
  </div>
</div>
<script>
document.addEventListener('touchstart',e=>{if(e.touches&&e.touches.length>1)e.preventDefault()},{passive:false});
document.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});
document.addEventListener('wheel',e=>e.preventDefault(),{passive:false});
['gesturestart','gesturechange','gestureend'].forEach(ev=>{
  document.addEventListener(ev,e=>e.preventDefault(),{passive:false});
});
let lastTouchEnd=0;
document.addEventListener('touchend',e=>{
  const n=Date.now();if(n-lastTouchEnd<=300)e.preventDefault();lastTouchEnd=n
},{passive:false});
const d=document.getElementById("display");
const badge=document.getElementById("badge");
let a=null,b=null,op=null,typing=false,lastEq=false;
const displayToNumber=()=>Number(d.textContent.replace(",","."));
const numberToDisplay=n=>{
  if(!isFinite(n))return"Error";
  let s=n.toString();if(s.length>12)s=n.toExponential(6).replace("+","");
  return s.replace(".",",");
};
const set=t=>d.textContent=t;
function clearAll(){a=b=op=null;typing=lastEq=false;set("0")}
function backspace(){
  let c=d.textContent;if(c.length<=1){set("0");typing=false;return}
  c=c.slice(0,-1);if(c.endsWith(","))c=c.slice(0,-1);
  set(c||"0");typing=true
}
function digit(n){
  if(lastEq){clearAll();typing=true;set(n);return}
  if(!typing||d.textContent==="0"){typing=true;set(n);return}
  if(d.textContent.length<14)set(d.textContent+n)
}
function dot(){
  if(lastEq){clearAll();typing=true;set("0,");return}
  if(!typing){typing=true;set("0,");return}
  if(!d.textContent.includes(","))set(d.textContent+",")
}
function sign(){set(numberToDisplay(-displayToNumber()));typing=true}
function percent(){set(numberToDisplay(displayToNumber()/100));typing=true}
function choose(o){
  if(a===null){a=displayToNumber();op=o;typing=false;lastEq=false;return}
  if(typing)equals();op=o;lastEq=false
}
function equals(){
  if(op===null)return;b=displayToNumber();
  let r={"+":a+b,"−":a-b,"×":a*b,"÷":b===0?NaN:a/b}[op];
  set(numberToDisplay(r));a=r;typing=false;lastEq=true
}
document.addEventListener("click",e=>{
  const btn=e.target.closest("button");if(!btn)return;
  if(btn.dataset.num)digit(btn.dataset.num);
  if(btn.dataset.op)choose(btn.dataset.op);
  switch(btn.dataset.action){
    case"ac":clearAll();break;
    case"backspace":backspace();break;
    case"dot":dot();break;
    case"sign":sign();break;
    case"percent":percent();break;
    case"equals":equals();break;
  }
});
(function(){
  const k=document.getElementById("key-1");let t=null;
  const s=()=>{t=setTimeout(()=>badge.classList.toggle("show"),520)};
  const e=()=>clearTimeout(t);
  k.addEventListener("touchstart",s,{passive:true});
  k.addEventListener("touchend",e,{passive:true});
  k.addEventListener("mousedown",s);
  k.addEventListener("mouseup",e);
})();
</script>
</body>
</html>
