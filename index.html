<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#000000">

<!-- iOS fullscreen -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<title>Calculadora</title>

<style>
:root{
  --bg:#000000;
  --key-dark:#333333;
  --key-fn:#a5a5a5;
  --key-op:#ff9f0a;
  --key-op-press:#ffb84d;
  --text:#ffffff;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text",system-ui;
}

*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}

html,body{
  margin:0;
  height:100%;
  background:var(--bg);
  color:var(--text);
  overflow:hidden;              /* no scroll */
  overscroll-behavior:none;     /* no pull-to-refresh bounce */
}

/* lock the viewport to avoid accidental scroll on iOS */
body{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  touch-action:manipulation;    /* reduce zoom/gestures */
  background:var(--bg);
}

/* Full-screen calculator (like iOS) */
.calculator{
  height:100dvh;
  width:100vw;
  background:var(--bg);
  display:flex;
  flex-direction:column;
  justify-content:flex-end;
  padding:
    max(10px, env(safe-area-inset-top))
    max(14px, env(safe-area-inset-right))
    max(14px, env(safe-area-inset-bottom))
    max(14px, env(safe-area-inset-left));
}

.display{
  height:140px;
  display:flex;
  align-items:flex-end;
  justify-content:flex-end;
  padding: 0 6px 10px 6px;
}

.display span{
  font-size:72px;
  font-weight:300;
  letter-spacing:-0.02em;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.keys{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:14px;
  padding-bottom: 4px;
}

button{
  border:none;
  border-radius:999px;
  height:76px;
  font-size:32px;
  cursor:pointer;
  user-select:none;
  touch-action:manipulation;
}

button:active{filter:brightness(1.12)}

.key-num{background:var(--key-dark);color:#fff}
.key-fn{background:var(--key-fn);color:#000}
.key-op{background:var(--key-op);color:#fff}
.key-op:active{background:var(--key-op-press)}

.zero{
  grid-column:span 2;
  text-align:left;
  padding-left:28px;
}

/* Small screens */
@media(max-width:380px){
  .display{height:128px}
  .display span{font-size:62px}
  button{height:70px;font-size:30px}
  .keys{gap:12px}
}
</style>
</head>

<body>

<div class="calculator" aria-label="Calculadora iOS">
  <div class="display"><span id="display">0</span></div>

  <div class="keys">
    <button class="key-fn" data-action="ac">AC</button>
    <button class="key-fn" data-action="sign">±</button>
    <button class="key-fn" data-action="percent">%</button>
    <button class="key-op" data-op="÷">÷</button>

    <button class="key-num" data-num="7">7</button>
    <button class="key-num" data-num="8">8</button>
    <button class="key-num" data-num="9">9</button>
    <button class="key-op" data-op="×">×</button>

    <button class="key-num" data-num="4">4</button>
    <button class="key-num" data-num="5">5</button>
    <button class="key-num" data-num="6">6</button>
    <button class="key-op" data-op="−">−</button>

    <button class="key-num" data-num="1">1</button>
    <button class="key-num" data-num="2">2</button>
    <button class="key-num" data-num="3">3</button>
    <button class="key-op" data-op="+">+</button>

    <button class="key-num zero" data-num="0">0</button>
    <button class="key-num" data-action="dot">,</button>
    <button class="key-op" data-action="equals">=</button>
  </div>
</div>

<script>
/* Extra guardrails for iOS Safari: avoid pinch-zoom and scroll */
document.addEventListener('gesturestart', e => e.preventDefault(), { passive: false });
document.addEventListener('gesturechange', e => e.preventDefault(), { passive: false });
document.addEventListener('gestureend', e => e.preventDefault(), { passive: false });
document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });
document.addEventListener('wheel', e => e.preventDefault(), { passive: false });

const d = document.getElementById("display");
let a=null,b=null,op=null,typing=false,lastEq=false;

// Use comma as decimal separator visually (like ES iOS), but compute with dot.
const displayToNumber = () => Number(d.textContent.replace(",", "."));
const numberToDisplay = (n) => {
  if (!isFinite(n)) return "Error";
  let s = n.toString();
  // keep iOS-like compactness
  if (s.length > 12) s = n.toExponential(6).replace("+","");
  return s.replace(".", ",");
};
const set = t => d.textContent = t;

function clearAll(){ a=b=op=null; typing=lastEq=false; set("0"); }

function digit(n){
  if(lastEq){ clearAll(); typing=true; set(n); return; }
  if(!typing || d.textContent==="0"){ typing=true; set(n); return; }
  if(d.textContent.length<14) set(d.textContent + n);
}

function dot(){
  if(lastEq){ clearAll(); typing=true; set("0,"); return; }
  if(!typing){ typing=true; set("0,"); return; }
  if(!d.textContent.includes(",")) set(d.textContent + ",");
}

function sign(){ set(numberToDisplay(-displayToNumber())); }

function percent(){ set(numberToDisplay(displayToNumber()/100)); }

function choose(o){
  if(a===null){ a=displayToNumber(); op=o; typing=false; lastEq=false; return; }
  if(typing){ equals(); }
  op=o; lastEq=false;
}

function equals(){
  if(op===null) return;
  b = displayToNumber();
  let r;
  switch(op){
    case"+": r=a+b; break;
    case"−": r=a-b; break;
    case"×": r=a*b; break;
    case"÷": r=(b===0)?NaN:(a/b); break;
  }
  set(numberToDisplay(r));
  a=r; typing=false; lastEq=true;
}

document.addEventListener("click", e=>{
  const btn = e.target.closest("button");
  if(!btn) return;

  if(btn.dataset.num) digit(btn.dataset.num);
  if(btn.dataset.op) choose(btn.dataset.op);

  switch(btn.dataset.action){
    case"ac": clearAll(); break;
    case"dot": dot(); break;
    case"sign": sign(); break;
    case"percent": percent(); break;
    case"equals": equals(); break;
  }
});
</script>

</body>
</html>
